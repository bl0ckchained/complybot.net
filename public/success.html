<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Success - ComplyBot</title>
  <link rel="stylesheet" href="style.css">
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-06FD4Z9W4E">
</script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-06FD4Z9W4E');
</script>
</head>
<body>
  <main class="success-container">
    <h1>✅ Payment Successful</h1>
    <p>Thanks for upgrading! Just one more step…</p>
    <p>To generate your full accessibility report, enter your website details below:</p>

    <p style="margin-top: 10px; font-style: italic; color: #333;">
      We’re now preparing your report. You’ll receive it via email within 24 hours.
      Questions? Email <a href="mailto:support@complybot.net">support@complybot.net</a>.
    </p>

    <form id="reportForm">
      <input type="email" name="email" placeholder="you@example.com" required>
      <input type="url" name="url" placeholder="https://yourwebsite.com" required>
      <input type="hidden" name="session_id" id="session_id">
      <button type="submit" class="cta-btn">Get My Full Report</button>
    </form>

    <p id="statusMessage" style="margin-top: 20px;"></p>
  </main>

  <script>
    // Get Stripe session ID from URL
    const params = new URLSearchParams(window.location.search);
    document.getElementById("session_id").value = params.get("session_id");

    // Submit form to trigger full scan
    document.getElementById("reportForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const email = e.target.email.value;
      const url = e.target.url.value;
      const session_id = e.target.session_id.value;

      const res = await fetch("/deliver-full-report", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, url, session_id })
      });

      const message = document.getElementById("statusMessage");

      if (res.ok) {
        message.textContent = "✅ Your full report has been emailed!";
      } else {
        message.textContent = "❌ There was an error. Please try again or contact support.";
      }
    });
  </script>
</body>
</html>
