<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ComplyBot - Inclusive & ADA-Compliant Web Solutions</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="/favicon.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    .spinning-globe {
      position: fixed;
      top: 1rem;
      right: 1rem;
      width: 60px;
      height: 60px;
      animation: spin 10s linear infinite;
      z-index: 9999;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .spinning-globe:hover {
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(155, 89, 182, 0.6);
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  <!-- Floating Spinning Logo -->
  <img src="images/complybot_logo2.png" alt="Spinning ComplyBot Logo" class="spinning-globe" />

  <!-- The rest of your original code follows -->
  <!-- ✅ Keep your orbital container, banner, navbar, sections, etc. -->

  <!-- Existing script tag and body ending -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.querySelector('form[action="/scan"]');
      if (form) {
        form.addEventListener("submit", function (e) {
          const url = document.querySelector('input[name="url"]').value;
          const email = document.querySelector('input[name="email"]').value;
          localStorage.setItem("url", url);
          localStorage.setItem("email", email);
        });
      }

      document.querySelectorAll(".upgrade-btn").forEach((btn) => {
        btn.addEventListener("click", async () => {
          const email = localStorage.getItem("email");
          const url = localStorage.getItem("url");
          if (!email || !url) {
            alert("Please run a scan first from the homepage.");
            return;
          }
          try {
            const res = await fetch("/create-checkout-session", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email, url }),
            });
            const data = await res.json();
            if (!data.url) throw new Error("Missing checkout URL from server");
            window.location.href = data.url;
          } catch (err) {
            alert("⚠️ Error starting checkout. Please try again.");
            console.error(err);
          }
        });
      });
    });
  </script>

  <!-- Extra form submission script -->
  <script>
    const params = new URLSearchParams(window.location.search);
    const sessionInput = document.getElementById("session_id");
    if (sessionInput) sessionInput.value = params.get("session_id");

    const reportForm = document.getElementById("reportForm");
    if (reportForm) {
      reportForm.addEventListener("submit", async function (e) {
        e.preventDefault();
        const email = e.target.email.value;
        const url = e.target.url.value;
        const session_id = e.target.session_id.value;
        const message = document.getElementById("statusMessage");
        message.textContent = "⏳ Submitting… please wait.";

        try {
          const res = await fetch("/deliver-full-report", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, url, session_id })
          });
          message.textContent = res.ok
            ? "✅ Your full report has been emailed!"
            : "❌ There was an error. Please try again or contact support.";
        } catch (err) {
          message.textContent = "❌ There was an error. Please try again or contact support.";
          console.error(err);
        }
      });
    }
  </script>
</body>
</html>
